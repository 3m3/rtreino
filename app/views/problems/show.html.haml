%div{:style => 'text-align: center'}
  %h1.heading= "Problem %s" % @problem.code
  %p
    %em= @problem.source

= render :partial => 'statements'

%h2 Analyses

%p= link_to 'New analysis', new_problem_analysis_path(@problem)

%table
  %thead.header
    %tr
      %th{:align => :left} Author
      %th Created
      %th Updated
      %th Actions
  - @problem.analyses.each do |analysis|
    %tr
      %td= analysis.user.username
      %td{:align => :center}= "%s ago" % time_ago_in_words(analysis.created_at)
      %td{:align => :center}= "%s ago" % time_ago_in_words(analysis.updated_at)
      %td{:align => :center}
        = link_to "Edit", edit_problem_analysis_path(@problem, analysis)
        |
        = link_to "Show", problem_analysis_path(@problem, analysis)

%div#analyses
  - @problem.analyses.each do |analysis|
    %div.analysis{ :id => "analysis_#{analysis.id}" }
      %p
        %em= "by %s" % analysis.user.username
      ~ analysis.body_html
      %p.actions
        - if current_user == analysis.user || current_user.admin?
          = link_to 'Edit', edit_problem_analysis_path(@problem, analysis)
          |
        = link_to 'New comment', new_analysis_comment_path(analysis)
        |
        = link_to_function 'View comments', "$(comments).toogle()"
      %h3 Comments
      %div#comments
        = render :partial => analysis.comments

